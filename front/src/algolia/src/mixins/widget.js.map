{"version":3,"file":"widget.js","sources":["../../../../src/mixins/widget.js"],"sourcesContent":["import { _objectSpread } from '../util/polyfills';\nimport { isVue3 } from '../util/vue-compat';\nimport { warn } from '../util/warn';\n\nexport const createWidgetMixin = (\n  { connector } = {},\n  additionalProperties = {}\n) => ({\n  inject: {\n    instantSearchInstance: {\n      from: '$_ais_instantSearchInstance',\n      default() {\n        const tag = this.$options._componentTag;\n        throw new TypeError(\n          `It looks like you forgot to wrap your Algolia search component \"<${tag}>\" inside of an \"<ais-instant-search>\" component.`\n        );\n      },\n    },\n    getParentIndex: {\n      from: '$_ais_getParentIndex',\n      default() {\n        return () => this.instantSearchInstance.mainIndex;\n      },\n    },\n  },\n  data() {\n    return {\n      state: null,\n    };\n  },\n  created() {\n    if (typeof connector === 'function') {\n      this.factory = connector(this.updateState, () => {});\n      this.widget = _objectSpread(\n        this.factory(this.widgetParams),\n        additionalProperties\n      );\n      this.getParentIndex().addWidgets([this.widget]);\n\n      if (\n        this.instantSearchInstance._initialResults &&\n        !this.instantSearchInstance.started\n      ) {\n        if (typeof this.instantSearchInstance.__forceRender !== 'function') {\n          throw new Error(\n            'You are using server side rendering with <ais-instant-search> instead of <ais-instant-search-ssr>.'\n          );\n        }\n        this.instantSearchInstance.__forceRender(\n          this.widget,\n          this.getParentIndex()\n        );\n      }\n    } else if (connector !== true) {\n      warn(\n        `You are using the InstantSearch widget mixin, but didn't provide a connector.\nWhile this is technically possible, and will give you access to the Helper,\nit's not the recommended way of making custom components.\n\nIf you want to disable this message, pass { connector: true } to the mixin.\n\nRead more on using connectors: https://alg.li/vue-custom`\n      );\n    }\n  },\n  [isVue3 ? 'beforeUnmount' : 'beforeDestroy']() {\n    if (this.widget) {\n      this.getParentIndex().removeWidgets([this.widget]);\n    }\n  },\n  watch: {\n    widgetParams: {\n      handler(nextWidgetParams) {\n        this.state = null;\n        this.getParentIndex().removeWidgets([this.widget]);\n        this.widget = _objectSpread(\n          this.factory(nextWidgetParams),\n          additionalProperties\n        );\n        this.getParentIndex().addWidgets([this.widget]);\n      },\n      deep: true,\n    },\n  },\n  methods: {\n    updateState(state = {}, isFirstRender) {\n      if (!isFirstRender) {\n        // Avoid updating the state on first render\n        // otherwise there will be a flash of placeholder data\n        this.state = state;\n      }\n    },\n  },\n});\n"],"names":["createWidgetMixin","ref","additionalProperties","inject","instantSearchInstance","from","default","tag","this","$options","_componentTag","TypeError","getParentIndex","mainIndex","data","state","created","connector","factory","updateState","widget","_objectSpread","widgetParams","addWidgets","_initialResults","started","__forceRender","Error","warn","removeWidgets","watch","handler","nextWidgetParams","deep","methods","isFirstRender"],"mappings":"yIAIaA,WACXC,EACAC,wBADgB,4CACO,OACnB,CACJC,OAAQ,CACNC,sBAAuB,CACrBC,KAAM,8BACNC,uBACQC,EAAMC,KAAKC,SAASC,oBACpB,IAAIC,8EAC4DJ,yDAI1EK,eAAgB,CACdP,KAAM,uBACNC,uDACeE,EAAKJ,sBAAsBS,cAI9CC,sBACS,CACLC,MAAO,OAGXC,sBAC2B,mBAAdC,WACJC,QAAUD,EAAUT,KAAKW,+BACzBC,OAASC,EACZb,KAAKU,QAAQV,KAAKc,cAClBpB,QAEGU,iBAAiBW,WAAW,CAACf,KAAKY,SAGrCZ,KAAKJ,sBAAsBoB,kBAC1BhB,KAAKJ,sBAAsBqB,QAC5B,IACwD,mBAA7CjB,KAAKJ,sBAAsBsB,oBAC9B,IAAIC,MACR,2GAGCvB,sBAAsBsB,cACzBlB,KAAKY,OACLZ,KAAKI,wBAGc,IAAdK,GACTW,EACE,uWAUN,yBACMpB,KAAKY,aACFR,iBAAiBiB,cAAc,CAACrB,KAAKY,YAG9CU,MAAO,CACLR,aAAc,CACZS,iBAAQC,QACDjB,MAAQ,UACRH,iBAAiBiB,cAAc,CAACrB,KAAKY,cACrCA,OAASC,EACZb,KAAKU,QAAQc,GACb9B,QAEGU,iBAAiBW,WAAW,CAACf,KAAKY,UAEzCa,MAAM,MAGVC,QAAS,CACPf,qBAAYJ,EAAYoB,kBAAJ,IACbA,SAGEpB,MAAQA"}