{"version":3,"file":"panel.js","sources":["../../../../src/mixins/panel.js"],"sourcesContent":["import { isVue3 } from '../util/vue-compat';\nimport mitt from 'mitt';\n\nexport const PANEL_EMITTER_NAMESPACE = 'instantSearchPanelEmitter';\nexport const PANEL_CHANGE_EVENT = 'PANEL_CHANGE_EVENT';\n\nexport const createPanelProviderMixin = () => ({\n  props: {\n    emitter: {\n      type: Object,\n      required: false,\n      default() {\n        return mitt();\n      },\n    },\n  },\n  provide() {\n    return {\n      [PANEL_EMITTER_NAMESPACE]: this.emitter,\n    };\n  },\n  data() {\n    return {\n      canRefine: true,\n    };\n  },\n  created() {\n    this.emitter.on(PANEL_CHANGE_EVENT, value => {\n      this.updateCanRefine(value);\n    });\n  },\n  [isVue3 ? 'beforeUnmount' : 'beforeDestroy']() {\n    this.emitter.all.clear();\n  },\n  methods: {\n    updateCanRefine(value) {\n      this.canRefine = value;\n    },\n  },\n});\n\nexport const createPanelConsumerMixin = ({\n  mapStateToCanRefine = state => Boolean(state.canRefine),\n} = {}) => ({\n  inject: {\n    emitter: {\n      from: PANEL_EMITTER_NAMESPACE,\n      default() {\n        return {\n          emit: () => {},\n        };\n      },\n    },\n  },\n  data() {\n    return {\n      state: null,\n      hasAlreadyEmitted: false,\n    };\n  },\n  watch: {\n    state: {\n      immediate: true,\n      handler(nextState, previousState) {\n        if (!nextState) {\n          return;\n        }\n\n        const previousCanRefine = mapStateToCanRefine(previousState || {});\n        const nextCanRefine = mapStateToCanRefine(nextState);\n\n        if (!this.hasAlreadyEmitted || previousCanRefine !== nextCanRefine) {\n          this.emitter.emit(PANEL_CHANGE_EVENT, nextCanRefine);\n          this.hasAlreadyEmitted = true;\n        }\n      },\n    },\n  },\n});\n"],"names":["PANEL_EMITTER_NAMESPACE","PANEL_CHANGE_EVENT","createPanelProviderMixin","props","emitter","type","Object","required","default","mitt","provide","this","data","canRefine","created","on","value","updateCanRefine","all","clear","methods","createPanelConsumerMixin","ref","state","Boolean","inject","from","emit","hasAlreadyEmitted","watch","immediate","handler","nextState","previousState","previousCanRefine","mapStateToCanRefine","nextCanRefine"],"mappings":"iEAGaA,EAA0B,4BAC1BC,EAAqB,qBAErBC,4BAAkC,CAC7CC,MAAO,CACLC,QAAS,CACPC,KAAMC,OACNC,UAAU,EACVC,0BACSC,OAIbC,kCACS,IACL,0BAA2BC,KAAKP,WAGpCQ,sBACS,CACLC,WAAW,IAGfC,mCACOV,QAAQW,GAvBiB,8BAuBMC,GAClCL,EAAKM,gBAAgBD,QAGzB,8BACOZ,QAAQc,IAAIC,WAEnBC,QAAS,CACPH,yBAAgBD,QACTH,UAAYG,OAKVK,WAA4BC,kBAErC,+DADoBC,UAASC,QAAQD,EAAMV,aACnC,CACVY,OAAQ,CACNrB,QAAS,CACPsB,KA3CiC,4BA4CjClB,yBACS,CACLmB,sBAKRf,sBACS,CACLW,MAAO,KACPK,mBAAmB,IAGvBC,MAAO,CACLN,MAAO,CACLO,WAAW,EACXC,iBAAQC,EAAWC,MACZD,OAICE,EAAoBC,EAAoBF,GAAiB,IACzDG,EAAgBD,EAAoBH,GAErCrB,KAAKiB,mBAAqBM,IAAsBE,SAC9ChC,QAAQuB,KApEW,qBAoEcS,QACjCR,mBAAoB"}